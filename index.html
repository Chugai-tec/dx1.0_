<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>毎日のフォーム一覧</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>車両運行記録</h1>
    <label for="employeeNumber">社員番号：</label>
    <input type="text" id="employeeNumber" placeholder="社員番号を入力" />
    <br />
    <div class ="vehicleselect">
      <label for="carSelect">車両選択：</label>
      <select id="carSelect">
        <option value="5066_デミオ１３００ＳＫＹ２ＷＤ">5066_デミオ１３００ＳＫＹ２ＷＤ</option>
        <option value="2978_レジアスエース２０００">2978_レジアスエース２０００</option>
        <option value="7565_ライトエースバン">7565_ライトエースバン</option>
        <option value="1522_ハイエース２．０">1522_ハイエース２．０</option>
        <option value="1675_プロボックス１．５ＤＸコンフォート">1675_プロボックス１．５ＤＸコンフォート</option>
        <option value="3601_デミオ１３Ｃ　２ＷＤ６ＥＣＡＴ">3601_デミオ１３Ｃ　２ＷＤ６ＥＣＡＴ</option>
        <option value="7713_レジアスエースＤＸ３．０">7713_レジアスエースＤＸ３．０</option>
        <option value="770_ハイエース　ディーゼル">770_ハイエース　ディーゼル</option>
        <option value="3017_アクア">3017_アクア</option>
        <option value="4224_ファミリアバン">4224_ファミリアバン</option>
        <option value="6266_ＮＶ３５０キャラバンＤＸ">6266_ＮＶ３５０キャラバンＤＸ</option>
        <option value="8268_キャラバン　ディーゼル">8268_キャラバン　ディーゼル</option>
        <option value="800_ＭＡＺＤＡ３　５ＨＢ">800_ＭＡＺＤＡ３　５ＨＢ</option>
        <option value="6453_キャラバン　ディーゼル">6453_キャラバン　ディーゼル</option>
        <option value="8677_ファミリアバンＶＥ">8677_ファミリアバンＶＥ</option>
        <option value="8999_カローラフィールダーＨＥＶ">8999_カローラフィールダーＨＥＶ</option>
        <option value="5078_ＡＤバン　ＶＥ">5078_ＡＤバン　ＶＥ</option>
        <option value="1087_ダイナトラック１ｔ系">1087_ダイナトラック１ｔ系</option>
    </select>
    </div>
    <span id="inspectionStatusLabel" style="margin-left: 10px; font-weight: bold;"></span>
    <ul class="form-list">
      
      <li><a id="dailyform" target="_blank">日常点検記録</a></li>
      <li><a id="alcoholcheckform" target="_blank">アルコールチェック</a></li>
      <li><a id="vehicleform" target="_blank">車両運行記録</a></li>
      <li><a id="refuelingform" target="_blank">給油</a></li>
      <li><a id="monthlyinspectionform" target="_blank">月例車両点検</a></li>
    </ul>
  </div>
  <script>
    // 各リンクとフォームURL（固定部分）
    const formLinks = [
      {
        id: 'dailyform',
        url: 'https://forms.office.com/Pages/ResponsePage.aspx?id=EcOKRIKR_EKLhTvQWVZxSqG8jiopPhRIoZpMUYcyf3hUN0o0NjZBOTJOREw5MTJGR0s5M1ozV1RNOS4u',
        employeeparamkey:'r5e017d4398184b50b2d39c6bca2e05b5',
        dayparamkey:'r2e40c18bd7d24dda87e30e6c2d707715',
        vehicleparamkey :'r6d36c0ccd4de48febe97959d26fddcf0'
      },
      {
        id: 'alcoholcheckform',
        url: 'https://forms.office.com/Pages/ResponsePage.aspx?id=EcOKRIKR_EKLhTvQWVZxSqG8jiopPhRIoZpMUYcyf3hUQkg3OU5JNjFKNEhRWU9WNUE1V0o0NlhCNy4u',
        employeeparamkey:'r5ba8aa5b55c046f796f1365b0bcb57a5',
        dayparamkey:'r6e757665ceaf4afcacdba9a6a17b05db',
        vehicleparamkey :'r8fc71a03c6b34417b27470d26b51cd5d'
      },
      {
        id: 'vehicleform',
        url: 'https://forms.office.com/Pages/ResponsePage.aspx?id=EcOKRIKR_EKLhTvQWVZxSqG8jiopPhRIoZpMUYcyf3hUQVFHVkVOVEgzSFJTODZMUzk3RURUWjhDMS4u',
        employeeparamkey:'rf4804a591cbc456cbcf187f6a588f037',
        dayparamkey:'r1aabda22cb064db1b32c9bcb7f4d85c8',
        vehicleparamkey :'r7510c096dddc4665888c88f3dc414c62'
      },
      {
        id: 'refuelingform',
        url: 'https://forms.office.com/Pages/ResponsePage.aspx?id=EcOKRIKR_EKLhTvQWVZxSqG8jiopPhRIoZpMUYcyf3hURUNHN1JPWUI0NjZRTjA3Uks2M1NRNVJDNS4u',
        employeeparamkey:'r37777b5195a4434497c7d2ad60f77f12',
        dayparamkey:'rc3416a3d38a34b0f87ac375160f8a169',
        vehicleparamkey :'r462f208bdd2c48e0ade76ad85ebcff94'
      },
      {
        id: 'monthlyinspectionform',
        url: 'https://forms.office.com/Pages/ResponsePage.aspx?id=EcOKRIKR_EKLhTvQWVZxSjx7RyfNd1lJm2DS8swImbVUMTdLVDNHUU9FU0tSUlI1WVFPTFQ2QlQzUi4u',
        employeeparamkey:'r415549a19aff47fbb4486ed88f7d8780',
        vehicleparamkey :'r8ccf8ebbba924fefb78cd0245a8733bb'
      }
    ];
    function updateLinks() {
      const selectedCar = encodeURIComponent(document.getElementById('carSelect').value);
      const employnumber = document.getElementById('employeeNumber').value;
      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth() + 1).padStart(2, '0'); // 月は0始まり
      const dd = String(today.getDate()).padStart(2, '0');
      const formatteddate = `${yyyy}-${mm}-${dd}`;

      formLinks.forEach(param => {
        let finalUrl = param.url;
        
        if (param.employeeparamkey){
          finalUrl += `&${param.employeeparamkey}=%22${employnumber}%22`;
        }
        if (param.dayparamkey){
          finalUrl += `&${param.dayparamkey}=%22${formatteddate}%22`;
        }
        if (param.vehicleparamkey) {
          finalUrl += `&${param.vehicleparamkey}=%22${selectedCar}%22`;
        }
        
        const anchor = document.getElementById(param.id);
        if (anchor) {
          anchor.href = finalUrl;
        }
      });
    }

    const empInput = document.getElementById('employeeNumber');
    const carSelect = document.getElementById('carSelect');
    // 初回と選択変更時に更新
    empInput.addEventListener('input', updateLinks);
    carSelect.addEventListener('change', updateLinks);

    updateLinks(); // 初期状態でもリンク反映

    window.addEventListener('DOMContentLoaded', () => {
    const savedEmp = localStorage.getItem('employeeNumber');
    if (savedEmp) empInput.value = savedEmp;

    const savedCar = localStorage.getItem('selectedCar');
    if (savedCar) carSelect.value = savedCar;

    updateLinks();
  });

  // 入力や選択変更時に保存＆リンク更新
  empInput.addEventListener('input', () => {
    localStorage.setItem('employeeNumber', empInput.value);
  });
  carSelect.addEventListener('change', () => {
    localStorage.setItem('selectedCar', carSelect.value);
  });

  async function checkDailyInspectionDuplicate(selectedCar) {
    // GitHub raw URL 例
    const url = 'https://raw.githubusercontent.com/KimuraTomonori/dx1.0_-/main/inspection-log.json';
    try {
      const res = await fetch(url);
      const data = await res.json();
      return data.includes(selectedCar);
    } catch (e) {
      return false; // エラー時は許可するなど適宜調整
    }
  }

  async function updateDailyFormStatus() {
    const dailyForm = document.getElementById('dailyform');
    const isDuplicate = await checkDailyInspectionDuplicate(document.getElementById('carSelect').value)
    if (isDuplicate) {
      dailyForm.style.pointerEvents = 'none';
      dailyForm.style.color = 'gray';
      dailyForm.textContent = '日常点検記録（本日入力済）';
      dailyForm.title = 'この車両は本日すでに点検済みです';
    } else {
      dailyForm.style.pointerEvents = 'auto';
      dailyForm.style.color = '';
      dailyForm.textContent = '日常点検記録';
      dailyForm.title = '';
    }
  }
  document.addEventListener('DOMContentLoaded', updateDailyFormStatus);
  carSelect.addEventListener('change', updateDailyFormStatus);
  updateDailyFormStatus()
  </script>
</body>
</html>

